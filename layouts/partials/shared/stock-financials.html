{{ $symbol := .symbol }}
{{ $stocks := .Site.Data.stocks.stocks }}
{{ $profile := where $stocks "symbol" $symbol }}



<div class="container p-0 m-0">
  <div class="content-section row d-none stock_social_row">
      <div class="col-12 d-lg-block">
          <div class="card-body tweet-header bg-dark text-white justify-content-center">
              <h4 class="card-title fw-semibold text-uppercase">FINANCIALS</h4>
          </div>
      </div>
  </div>

  <div class="row pb-3 justify-content-evenly text-center">
    <div class="col-4">
      <div class="card rounded  d-flex h-100">
        <div class="card-body">
            <div class="fs-1" id="financials_cagr">-</div>
            <div class="text-muted" title="Compund Annual Growth Rate">CAGR</div>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="card rounded d-flex h-100">
        <div class="card-body">
          <div class="fs-1" id="financials_ltm_gross_margin">-</div>
          <div class="text-muted" title="Trailing 12 Months - Gross Margin">Gross Margin (TTM)</div>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="card rounded d-flex  h-100">
        <div class="card-body">
          <div class="fs-1" id="financials_ltm_fcf_margin">-</div>
          <div class="text-muted" title="Trailing 12 Months - Free Cash Flow Margin">Free Cash Flow Net Margin (TTM)</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row pb-3 text-center">
    <div class="col-lg-6 col-12">
      <div class="card rounded">
        <div class="card-title p-3 fw-bold">
          QUARTERLY REVENUE
        </div>
        <div class="card-body">
          <div  id="revenueChart"></div>
        </div>
      </div>
    </div>
    <div class="col-lg-6 col-12">
      <div class="card rounded">
        <div class="card-title p-3 fw-bold">
          EARNINGS PER SHARE
        </div>
        <div class="card-body">
          <div  id="epsChart"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="row pb-3 text-center">
    <div class="col-lg-12 col-12">
      <div class="card rounded">
        <div class="card-body p-5">
            <div id="sankey_chart" style="height: 600px"></div>
        </div>
    </div>
  </div>

  <div class="row pb-3">
    <div class="col-12">
      <div class="card rounded">
        <div class="card-body">
          <div class="tradingview-financials-widget-container__widget"></div>
          <script type="application/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-financials.js" async>
            {
              "isTransparent": false,
              "largeChartUrl": "",
              "displayMode": "regular",
              "width": "100%",
              "height": "800",
              "colorTheme": "light",
              "symbol": "{{ $symbol }}",
              "locale": "en"
            }
          </script>
        </div>
      </div>
    </div>
  </div>


</div>

<script>
  // Initialize the chart
  var chart = echarts.init(document.getElementById('sankey_chart'));

  // Function to fetch data from the API
  async function fetchData() {
      const response = await fetch('https://us-central1-spyder-academy.cloudfunctions.net/stock_financials?ticker={{$symbol}}');
      const data = await response.json();
      return data["income_statements"][0];
  }

  // Function to process data and set chart options
  async function renderChart() {
    const quarterlyEarnings = await fetchData();

    var product_nodes = quarterlyEarnings.revenue_sources.map(source => ({
            "name": source.name,
            "value": parseFloat(source.value),
            "depth": 0,
            "itemStyle": { color: "#0065fe"}, label: {position: "top", color: "#0065fe"},
            "append": {name: "Amount", value: monetize(source.value, quarterlyEarnings.revenue)}
        }))

    product_nodes = quarterlyEarnings.revenue_sources.reduce((acc, source) => {
      const existingNode = acc.find(node => node.name === source.name);

      if (existingNode) {
          existingNode.value += parseFloat(source.value);
      } 
      else {
          acc.push({
              "name": source.name,
              "value": parseFloat(source.value),
              "depth": 0,
              "itemStyle": { color: "#0065fe"},
              "label": {position: "top", color: "#0065fe"},
              "append": {name: "Amount", value: monetize(source.value, quarterlyEarnings.revenue)}
          });
      }

      return acc;
    }, []);

    product_nodes = product_nodes.sort((a, b) => b.value - a.value).slice(0, 5);

    function monetize(v, t = 0){
      var pv = v
      v = Math.abs(parseFloat(v))
      if (v >= 1e9){
        pv = `$${(parseFloat(v)/1e9).toFixed(1)}B`
      }
      else if (v >= 1e6){
        pv = `$${(parseFloat(v)/1e6).toFixed(1)}M`
      }
      else if (v >= 1e3){
        pv = `$${(parseFloat(v)/1e3).toFixed(1)}K`
      }
      else{
        pv = `$${(parseFloat(v)).toFixed(1)}`
      }
      
      if (t == 0){
        return pv
      }
      else{
        var pct = (parseFloat(v)/parseFloat(t))*100
        return `${pv} (${pct.toFixed(1)}%)`
      }
    }

    function get_income_color(v){
      if (v > 0) {return "#2ba02d"}// green
      else {return "#cc0003"}// red
    }

    function get_expense_color(v){
      if (v > 0) {return "#cc0003"}// green
      else {return "#2ba02d"}// red
    }

    function get_node(n, v, d, type){
      const color = (type == "out") ? get_expense_color(v) : get_income_color(v);


      return {
        "name": n, 
        "value": Math.abs(v), 
        "depth": d, 
        "itemStyle": { 
          color: color
        }, 
        "label": {
          position: type == "out" ? "bottom" : "top", 
          align: "center",
          color: color, 
          show: (v != 0 ? true : false)
        }, 
        append: {
          name: "Amount", 
          value: monetize(v, quarterlyEarnings.revenue)
        }  
      }
    }

    function get_link(s, d, v, type){
      var color = ""
      if (v == 0){
        color = "transparent"
      }
      else{
        color = (type == "out") ? get_expense_color(v) : get_income_color(v);
      }
      return { 
        "source": s, 
        "target": d, 
        "value": Math.abs(v), 
        "lineStyle": {
          color: color , 
          opacity: 0.5
        } 
      }
    }

    // Extract nodes
    const nodes = [
        ...product_nodes,
        { "name": "1-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.25, depth: 1, itemStyle: { color: "transparent"}, label: {show: false}, emphasis: {label: {show: false}} },
        get_node("Revenue", quarterlyEarnings.revenue, 1, "in"),
        
        { "name": "2-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.15, depth: 2, itemStyle: { color: "transparent"}, label: {show: false} },
        get_node("Gross Profit", quarterlyEarnings.gross_profit, 2, "in"),
        get_node("COGS", quarterlyEarnings.cost_of_revenue, 2, "out"),
        
        { "name": "3-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.10, depth: 3, itemStyle: { color: "transparent"}, label: {show: false} },
        get_node("Operating Income", quarterlyEarnings.operating_income, 3, "in"),
        get_node("Operating Expense", quarterlyEarnings.operating_expense, 3, "out"),
        
        { "name": "4-1", "value": parseFloat(quarterlyEarnings.revenue) * 0, depth: 4, itemStyle: { color: "transparent"}, label: {show: false} },
        get_node("PreTax Income", quarterlyEarnings.ebit, 4, "in"),

        { "name": "5-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.00, depth: 5, itemStyle: { color: "transparent"}, label: {show: false} },
        get_node("Net Income", quarterlyEarnings.net_income, 5, "in"),
        get_node("Tax", quarterlyEarnings.income_tax_expense, 5, "out"),
        get_node("Interest Expense", quarterlyEarnings.interest_expense, 5, "out"),
        get_node("SG&A", quarterlyEarnings.selling_general_and_administrative_expenses, 5, "out"),
        get_node("R&D", quarterlyEarnings.research_and_development, 5, "out"),
        get_node("Other", quarterlyEarnings.other_expenses, 5, "out"),


        // { "name": "Revenue", "value": parseFloat(quarterlyEarnings.revenue), depth: 1, itemStyle: { color: get_income_color(quarterlyEarnings.revenue)}, label: {position: "top", align: "center", color: "black"}, append: {name: "Amount", value: monetize(quarterlyEarnings.revenue)}, emphasis: {label: {}} },

        // { "name": "2-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.15, depth: 2, itemStyle: { color: "transparent"}, label: {show: false} },
        // { "name": "Gross Profit", "value": parseFloat(quarterlyEarnings.gross_profit), depth: 2, itemStyle: { color: get_income_color(quarterlyEarnings.gross_profit)}, label: {position: "top", color: "green", align: "center"}, append: {name: "Amount", value: monetize(quarterlyEarnings.gross_profit, quarterlyEarnings.revenue)} },
        // { "name": "COGS", "value": parseFloat(quarterlyEarnings.cost_of_revenue), depth: 2, itemStyle: { color: get_expense_color(quarterlyEarnings.cost_of_revenue)}, label: {position: "bottom", color: "red", align: "center"}, append: {name: "Amount", value: monetize(quarterlyEarnings.cost_of_revenue, quarterlyEarnings.revenue)}  },
        
        
        // { "name": "3-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.10, depth: 3, itemStyle: { color: "transparent"}, label: {show: false} },
        // { "name": "Operating Income", "value": parseFloat(quarterlyEarnings.operating_income), depth: 3, itemStyle: { color: get_income_color(quarterlyEarnings.operating_income)}, label: {position: "top", color: "green", align: "center"}, append: {name: "Amount", value: monetize(quarterlyEarnings.operating_income, quarterlyEarnings.revenue)}  },
        // { "name": "Operating Expense", "value": parseFloat(quarterlyEarnings.operating_expense), depth: 3, itemStyle: {color: get_expense_color(quarterlyEarnings.operating_expense)}, label: {position: "bottom", color: "red"}, append: {name: "Amount", value: monetize(quarterlyEarnings.operating_expense, quarterlyEarnings.revenue)} },
        
        // { "name": "4-1", "value": parseFloat(quarterlyEarnings.revenue) * 0, depth: 4, itemStyle: { color: "transparent"}, label: {show: false} },
        // { "name": "Pretax Income", "value": parseFloat(quarterlyEarnings.ebit), depth: 4, itemStyle: { color: get_income_color(quarterlyEarnings.ebit)}, label: {position: "top", color: "green", align: "center"}, append: {name: "Amount", value: monetize(quarterlyEarnings.ebit, quarterlyEarnings.revenue)}  },
        
        // // { "name": "5-1", "value": parseFloat(quarterlyEarnings.revenue) * 0.00, depth: 5, itemStyle: { color: "transparent"}, label: {show: false} },
        // { "name": "Net Income", "value": parseFloat(quarterlyEarnings.net_income), depth: 5, itemStyle: { color: get_income_color(quarterlyEarnings.net_income)}, label: {position: "right", color: "green"}, append: {name: "Amount", value: monetize(quarterlyEarnings.net_income, quarterlyEarnings.revenue)}  },
        // { "name": "Tax", "value": Math.abs(parseFloat(quarterlyEarnings.income_tax_expense)), depth: 5, itemStyle: { color: get_expense_color(quarterlyEarnings.income_tax_expense)}, label: {position: "right", color: (quarterlyEarnings.income_tax_expense > 0 ? "red" : "green")}, append: {name: "Amount", value: monetize(Math.abs(quarterlyEarnings.income_tax_expense), quarterlyEarnings.revenue)}  },
        // { "name": "Interest Expense", "value": parseFloat(quarterlyEarnings.interest_expense), depth: 5, itemStyle: { color: get_expense_color(quarterlyEarnings.interest_expense)}, label: {position: "right", color: "red", show: (quarterlyEarnings.interest_expense > 0 ? true : false)}, append: {name: "Amount", value: monetize(quarterlyEarnings.interest_expense, quarterlyEarnings.revenue)}  },
        // { "name": "SG&A", "value": parseFloat(quarterlyEarnings.selling_general_and_administrative_expenses), depth: 5, itemStyle: { color: get_expense_color(quarterlyEarnings.selling_general_and_administrative_expenses)}, label: {position: "right", color: "red", show: (quarterlyEarnings.selling_general_and_administrative_expenses > 0 ? true : false)}, append: {name: "Amount", value: monetize(quarterlyEarnings.selling_general_and_administrative_expenses, quarterlyEarnings.revenue)}  },
        // { "name": "R&D", "value": parseFloat(quarterlyEarnings.research_and_development), depth: 5, itemStyle: { color: get_expense_color(quarterlyEarnings.research_and_development)}, label: {position: "right", color: "red", show: (quarterlyEarnings.research_and_development > 0 ? true : false)}, append: {name: "Amount", value: monetize(quarterlyEarnings.research_and_development, quarterlyEarnings.revenue)}  },
        // { "name": "Other", "value": parseFloat(quarterlyEarnings.other_expenses), depth: 5, itemStyle: { color: get_expense_color(quarterlyEarnings.other_expenses) }, label: {position: "right", color: "red", show: (quarterlyEarnings.other_expenses > 0 ? true : false)}, append: {name: "Amount", value: monetize(quarterlyEarnings.other_expenses, quarterlyEarnings.revenue)}  },
        
    ];


    // Extract links

    var product_links = quarterlyEarnings.revenue_sources.map(source => ({
            "source": source.name,
            "target": "Revenue",
            "value": parseFloat(source.value),
            "lineStyle": {
              "color": "#0065fe",
              "opacity": 0.5
            }
        }))

        product_links = product_links.sort((a, b) => b.value - a.value).slice(0, 5);


    const links = [
        ...product_links,
        get_link("Revenue", "Gross Profit", quarterlyEarnings.gross_profit, "in"),
        get_link("Gross Profit", "Operating Income", quarterlyEarnings.operating_income, "in"),
        get_link("Gross Profit", "Operating Expense", quarterlyEarnings.operating_expense, "out"),
        get_link("Operating Income", "PreTax Income", quarterlyEarnings.ebit, "in"),
        get_link("PreTax Income", "Net Income", quarterlyEarnings.net_income, "in"),
        get_link("PreTax Income", "Tax", quarterlyEarnings.income_tax_expense, "out"),
        get_link("PreTax Income", "Interest Expense", quarterlyEarnings.interest_expense, "out"),
        get_link("Operating Expense", "SG&A", quarterlyEarnings.selling_general_and_administrative_expenses, "out"),
        get_link("Operating Expense", "R&D", quarterlyEarnings.research_and_development, "out"),
        get_link("Operating Expense", "Other", quarterlyEarnings.other_expenses, "out"),
        get_link("Revenue", "COGS", quarterlyEarnings.cost_of_revenue, "out"),

        // { "source": "Revenue", "target": "Gross Profit", "value": parseFloat(quarterlyEarnings.gross_profit), lineStyle: {color: "#99ce9a", opacity: 0.5}},
        // { "source": "Gross Profit", "target": "Operating Income", "value": parseFloat(quarterlyEarnings.operating_income), lineStyle: {color: "#99ce9a", opacity: 0.5}},
        // { "source": "Gross Profit", "target": "Operating Expense", "value": parseFloat(quarterlyEarnings.operating_expense), lineStyle: {color: "#cc0003", opacity: 0.5} },
        // { "source": "Operating Income", "target": "Pretax Income", "value": parseFloat(quarterlyEarnings.ebit), lineStyle: {color: "#99ce9a", opacity: 0.5} },
        // { "source": "Pretax Income", "target": "Net Income", "value": parseFloat(quarterlyEarnings.net_income), lineStyle: {color: "#99ce9a", opacity: 0.5} },
        // { "source": "Pretax Income", "target": "Tax", "value": parseFloat(quarterlyEarnings.income_tax_expense), lineStyle: {color: (quarterlyEarnings.income_tax_expense > 0 ? "#cc0003" : "#99ce9a"), opacity: 0.5} },
        // { "source": "Pretax Income", "target": "Interest Expense", "value": parseFloat(quarterlyEarnings.interest_expense), lineStyle: {color: (quarterlyEarnings.interest_expense > 0 ? "#cc0003" : "transparent"), opacity: 0.5} },
        // { "source": "Operating Expense", "target": "SG&A", "value": parseFloat(quarterlyEarnings.selling_general_and_administrative_expenses), lineStyle: {color:  (quarterlyEarnings.selling_general_and_administrative_expenses > 0 ? "#cc0003" : "transparent"), opacity: 0.5} },
        // { "source": "Operating Expense", "target": "R&D", "value": parseFloat(quarterlyEarnings.research_and_development), lineStyle: {color: (quarterlyEarnings.research_and_development > 0 ? "#cc0003" : "transparent"), opacity: 0.5} },
        // { "source": "Operating Expense", "target": "Other", "value": parseFloat(quarterlyEarnings.other_expenses), lineStyle: {color: (quarterlyEarnings.other_expenses > 0 ? "#cc0003" : "transparent"), opacity: 0.5} },
        // { "source": "Revenue", "target": "COGS", "value": parseFloat(quarterlyEarnings.cost_of_revenue), lineStyle: {color: "#cc0003", opacity: 0.5} },
        
    ];

    console.log("Data Node: ", nodes)
    console.log("Data Links: ", links)
    // Define the chart options
    var option = {
      "mode": 1,
      "animation": false,
      title: {
        text: `How ${quarterlyEarnings.ticker} Makes Money (${quarterlyEarnings["report_period"]})`,
        left: 'center',
        textStyle: {
          fontSize: 30
        }
      },
      tooltip: {
        trigger: 'item',
        triggerOn: 'mousemove'
      },
      toolbox: {
        feature: {
            saveAsImage: {
                show: true,
                type: 'png',
                title: 'Save Chart - How {{$symbol}} Makes Money',
                name: 'how_{{$symbol}}_makes_money',
            }
        },
        bottom: 0
      },
      
      series: [
        {
          type: 'sankey',
          layout: 'none',
          emphasis: {
            focus: "adjacency",
            label: {
              show: true
            },
            lineStyle: {
              opacity: 0.5
            }
          },
          layoutIterations: 0,
          nodeGap: 50,
          left: 180,
          top: 160,
          bottom: 80,
          right: 180,
          lineStyle: {
            curveness: 0.7,
            color: 'source',
          },
          nodeAlign: 'justify',


          data: nodes,
          links: links,
          label: {
            formatter: function(params) {
              const name = params.name;
              const append = params.data.append;
              console.log(params.name, append)

              if (append !== undefined){
                return [
                    `${name}`,
                    `{append|${append.value}}`
                ].join("\n")
              }
              else{
                return `${name}`
              }
            },
            rich: {
              append: {
                color: "#c0c0c0",
                fontSize: 12,
                padding: [2, 0, 0, 0]
              }
            },
            "show": true,
            "position": "right",
            "fontSize": 15,
          },
          
          itemStyle: {
            color: function (params) {
              const name = params.data.name;
              if (name === 'Revenue' || name === 'Gross Profit' || name === 'Operating Income' || name === 'Pretax Income' || name === 'Net Income') {
                return 'green';
              } else if (name.includes('Expense') || name.includes('Cost')) {
                return 'red';
              } else {
                return 'blue';
              }
            }
          },
        }
      ],
      // Adding the footer
      graphic: [
        {
          type: 'text',
          left: 'center',
          bottom: 0,
          style: {
            text: 'Created by Spyder Academy',
            fill: '#c0c0c0',
            fontSize: 15
          }
        },
        {
          type: 'image',
          left: 'center',
          bottom: 20,
          style: {
            image: '/images/logo.png',
            width: 50,
            height: 50
          }
        },
        {
          type: 'image',
          left: 'center',
          top: 40,
          style: {
            image: `/images/logos/${quarterlyEarnings.ticker}.png`,
            width: 50,
            height: 50
          }
        }
      ]
    };

    // Use the specified chart configuration
    chart.setOption(option);
  }

  // Render the chart
  renderChart();
</script>





<script>

  // // ORIGINAL CODEGURU CHART SETUP THAT WORKS!

  // var option = {
  //     "mode": 1,
  //     "animation": false,
  //     "darkMode": "auto",
  //     "colorBy": "series",
  //     "color": [
  //       "#5470c6",
  //       "#91cc75",
  //       "#fac858",
  //       "#ee6666",
  //       "#73c0de",
  //       "#3ba272",
  //       "#fc8452",
  //       "#9a60b4",
  //       "#ea7ccc"
  //     ],
  //     "gradientColor": [
  //       "#f6efa6",
  //       "#d88273",
  //       "#bf444c"
  //     ],
  //     "aria": {
  //       "decal": {
  //         "decals": [
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "dashArrayX": [
  //               1,
  //               0
  //             ],
  //             "dashArrayY": [
  //               2,
  //               5
  //             ],
  //             "symbolSize": 1,
  //             "rotation": 0.5235987755982988
  //           },
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "symbol": "circle",
  //             "dashArrayX": [
  //               [
  //                 8,
  //                 8
  //               ],
  //               [
  //                 0,
  //                 8,
  //                 8,
  //                 0
  //               ]
  //             ],
  //             "dashArrayY": [
  //               6,
  //               0
  //             ],
  //             "symbolSize": 0.8
  //           },
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "dashArrayX": [
  //               1,
  //               0
  //             ],
  //             "dashArrayY": [
  //               4,
  //               3
  //             ],
  //             "rotation": -0.7853981633974483
  //           },
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "dashArrayX": [
  //               [
  //                 6,
  //                 6
  //               ],
  //               [
  //                 0,
  //                 6,
  //                 6,
  //                 0
  //               ]
  //             ],
  //             "dashArrayY": [
  //               6,
  //               0
  //             ]
  //           },
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "dashArrayX": [
  //               [
  //                 1,
  //                 0
  //               ],
  //               [
  //                 1,
  //                 6
  //               ]
  //             ],
  //             "dashArrayY": [
  //               1,
  //               0,
  //               6,
  //               0
  //             ],
  //             "rotation": 0.7853981633974483
  //           },
  //           {
  //             "color": "rgba(0, 0, 0, 0.2)",
  //             "symbol": "triangle",
  //             "dashArrayX": [
  //               [
  //                 9,
  //                 9
  //               ],
  //               [
  //                 0,
  //                 9,
  //                 9,
  //                 0
  //               ]
  //             ],
  //             "dashArrayY": [
  //               7,
  //               2
  //             ],
  //             "symbolSize": 0.75
  //           }
  //         ]
  //       }
  //     },
  //     "textStyle": {
  //       "fontFamily": "sans-serif",
  //       "fontSize": 12,
  //       "fontStyle": "normal",
  //       "fontWeight": "normal"
  //     },
  //     "stateAnimation": {
  //       "duration": 300,
  //       "easing": "cubicOut"
  //     },
  //     "animationDuration": 1000,
  //     "animationDurationUpdate": 500,
  //     "animationEasing": "cubicInOut",
  //     "animationEasingUpdate": "cubicInOut",
  //     "animationThreshold": 2000,
  //     "progressiveThreshold": 3000,
  //     "progressive": 400,
  //     "hoverLayerThreshold": 3000,
  //     "useUTC": false,
  //     "graphic": [
  //       {
  //         "elements": [
  //           {
  //             "type": "image",
  //             "style": {
  //               "image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABAtJREFUaEPtmH1sE2Ucxz93t2vXbV2HjLF21M1lBKeiASW+kRmVF40uIokzakiMxtcs6l/+YVxGgv/hPyRLDCGK0fgHYlAzUWEYI8FAIoJKCBqWOfbSdS8Ibddu7fXuMXfdHAjbbK+VLLnnj16uzz2/3/fl93vy3En9/jsFC3hIDoFr7J7jwDU2AMcBxwGbCjglZFNA28sdB2xLaDNA/h3QBQhQFnmRfWUWPCMyjn4hBhKgmD/5G7YISC6Vksc3oDY2gDQFzMAiIJeXIHtLMwRicYxoIkNAngIvBNqZbhKfH0SktJwZZU3A1VhP8UP3oQSqkdQi3HetQgn6IZlk8pvDTB79FaFpGaWnxTbPu7pAUlWK776N4oebwO1G7x8ieewkQkujh8JMfvsDqTM9WZHJioBnYxNlLzyJetNypLRG/JNOUn/0IHtLKNu8AaGopPvD6D29RDo+RiRTFhjJ7cLXugWlvo6i4FIkXWN8XxdGLIFrRT2lzzQjVBXt9FnGd+1h4sDh/0wiKwLe1i2o9XUkvvqesic2IldVol+MYpaS6+YG6x5ZRkSijKx/Fm0gZAFRlwWo6voQyVcOhoExMkbqdLdVOkqFF2N4jPhnB/E8ej9azzliHR8VhkBR0E9JyyO4bl+JurwWJbB0pvb/lTJ1/BQjzS9Z/1Z17sR1x8qrgxICfXAYrfscqZ9Pkfh0P+n+ocIQMKOatV/R1ornsXWZBu0bILJ9N1pvv9Wgi997ByVQZc2lfvrNurrW3Gpd9dAw519pA0Og1gXxvfkccnCZNTfx5SEubuuweiGbkVUJTQdWqpdQsfV1iteuJrKtg/gX3yGSSWu64q0XKX3+KSSP5zIcYjxBbPtOorv2TPWFm9JND+Jra2XyyAkubt2BHh7NBnsmTq6vlPLiRcilHvTRvxATk/8kllweqo/tRamuvAyMHh4jvGYzQs80tpXcU4yy5DqM+ATG+QtZg7dFYNZsAvwnOzFdunSY6g6tap7ZWnOCe+WinB2YK7//xCwEVjfnCfZMGIfA1ST1H/gA5ZbGS44XBunjvxDe9OrCcMDdUEvl17uRykoswCIWZ/SBp0kNDi8MAqQFgbOHkH1eC7ARiRFasQ7k/J5EC7MLTWkc+L0LuXyKQDRG6Mb1eVffITDnVnp0L0pt0HpE7+1j6J6WheVA+cstlL/9hgU62v4u0ff3LSwC5gtMzcCPFujBwL2g5r+BC9oDZvCaviMZAtevLYj6DoH5ZK35M/NqOHhD03yP5jxfkLPQNJrKHe0gyYy91p4zwPkWFpSAGqix8muhwflw5DxfUAIibX7kMj+nTH8MyhnnrAsLSiD/cK+M6BD4P1SeK4fjgOOATQWcErIpoO3ljgO2JbQZ4G8j5bOgubd7ywAAAABJRU5ErkJggg==",
  //               "width": 48,
  //               "height": 48
  //             },
  //             "left": 150,
  //             "top": 12,
  //             "id": "\u0000series\u00000\u00000",
  //             "parentOption": null,
  //             "hv": [
  //               true,
  //               true
  //             ]
  //           },
  //           {
  //             "type": "text",
  //             "style": {
  //               "text": "Tesla Inc",
  //               "font": "bold 18px Inter, arial",
  //               "fill": "#3e4763",
  //               "align": null,
  //               "verticalAlign": null,
  //               "textBaseline": null,
  //               "textVerticalAlign": null
  //             },
  //             "left": 210,
  //             "top": 26,
  //             "id": "\u0000series\u00001\u00000",
  //             "parentOption": null,
  //             "hv": [
  //               true,
  //               true
  //             ]
  //           }
  //         ]
  //       }
  //     ],
  //     "axisPointer": [
  //       {
  //         "show": "auto",
  //         "z": 50,
  //         "type": "line",
  //         "snap": false,
  //         "triggerTooltip": true,
  //         "value": null,
  //         "status": null,
  //         "link": [],
  //         "animation": null,
  //         "animationDurationUpdate": 200,
  //         "lineStyle": {
  //           "color": "#B9BEC9",
  //           "width": 1,
  //           "type": "dashed"
  //         },
  //         "shadowStyle": {
  //           "color": "rgba(210,219,238,0.2)"
  //         },
  //         "label": {
  //           "show": true,
  //           "formatter": null,
  //           "precision": "auto",
  //           "margin": 3,
  //           "color": "#fff",
  //           "padding": [
  //             5,
  //             7,
  //             5,
  //             7
  //           ],
  //           "backgroundColor": "auto",
  //           "borderColor": null,
  //           "borderWidth": 0,
  //           "borderRadius": 3
  //         },
  //         "handle": {
  //           "show": false,
  //           "icon": "M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",
  //           "size": 45,
  //           "margin": 50,
  //           "color": "#333",
  //           "shadowBlur": 3,
  //           "shadowColor": "#aaa",
  //           "shadowOffsetX": 0,
  //           "shadowOffsetY": 2,
  //           "throttle": 40
  //         }
  //       }
  //     ],
  //     "tooltip": [
  //       {
  //         "trigger": "item",
  //         "triggerOn": "mousemove",
  //         "z": 60,
  //         "show": true,
  //         "showContent": true,
  //         "alwaysShowContent": false,
  //         "displayMode": "single",
  //         "renderMode": "auto",
  //         "confine": null,
  //         "showDelay": 0,
  //         "hideDelay": 100,
  //         "transitionDuration": 0.4,
  //         "enterable": false,
  //         "backgroundColor": "#fff",
  //         "shadowBlur": 10,
  //         "shadowColor": "rgba(0, 0, 0, .2)",
  //         "shadowOffsetX": 1,
  //         "shadowOffsetY": 2,
  //         "borderRadius": 4,
  //         "borderWidth": 1,
  //         "padding": null,
  //         "extraCssText": "",
  //         "axisPointer": {
  //           "type": "line",
  //           "axis": "auto",
  //           "animation": "auto",
  //           "animationDurationUpdate": 200,
  //           "animationEasingUpdate": "exponentialOut",
  //           "crossStyle": {
  //             "color": "#999",
  //             "width": 1,
  //             "type": "dashed",
  //             "textStyle": {}
  //           }
  //         },
  //         "textStyle": {
  //           "color": "#666",
  //           "fontSize": 14
  //         }
  //       }
  //     ],
  //     "yAxis": [],
  //     "xAxis": [],
  //     "grid": [
  //       {
  //         "x": 10,
  //         "x2": 10,
  //         "y": 10,
  //         "y2": 10,
  //         "containLabel": true,
  //         "borderWidth": 0,
  //         "left": 10,
  //         "top": 10,
  //         "right": 10,
  //         "bottom": 10,
  //         "show": false,
  //         "z": 0,
  //         "backgroundColor": "rgba(0,0,0,0)",
  //         "borderColor": "#ccc"
  //       }
  //     ],
  //     "series": [
  //       {
  //         "type": "sankey",
  //         "layout": "none",
  //         "emphasis": {
  //           "focus": "adjacency",
  //           "label": {
  //             "show": true
  //           },
  //           "lineStyle": {
  //             "opacity": 0.5
  //           }
  //         },
  //         "layoutIterations": 0,
  //         "nodeGap": 50,
  //         "left": 150,
  //         "top": 120,
  //         "bottom": 60,
  //         "right": 110,
  //         "itemStyle": {
  //           "color2": "#c1c7d0"
  //         },
  //         "label": {
  //           "rich": {
  //             "green": {
  //               "color": "#2ba02d",
  //               "fontWeight": "bold",
  //               "fontSize": 11
  //             },
  //             "red": {
  //               "color": "#cc0003",
  //               "fontWeight": "bold",
  //               "fontSize": 11
  //             },
  //             "blue": {
  //               "color": "#0065fe",
  //               "fontWeight": "bold",
  //               "fontSize": 11
  //             },
  //             "black": {
  //               "color": "#081131",
  //               "fontWeight": "bold",
  //               "fontSize": 11
  //             },
  //             "value": {
  //               "color": "#6d7794",
  //               "padding": [
  //                 2,
  //                 0,
  //                 0,
  //                 0
  //               ],
  //               "fontSize": 10
  //             },
  //             "append": {
  //               "color": "#6d7794",
  //               "padding": [
  //                 2,
  //                 0,
  //                 0,
  //                 0
  //               ],
  //               "fontSize": 10
  //             }
  //           },
  //           "show": true,
  //           "position": "right",
  //           "fontSize": 12
  //         },
  //         "data": [
  //           {
  //             "name": "Automotive segment",
  //             "value": 90738,
  //             "depth": 0,
  //             "itemStyle": {
  //               "color": "#4285f4",
  //               "align": "right"
  //             },
  //             "label": {
  //               "position": [
  //                 -125,
  //                 "20%"
  //               ],
  //               "width": 125,
  //               "overflow": "break"
  //             },
  //             "color": "blue",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Energy generation and storage segment",
  //             "value": 6035,
  //             "depth": 0,
  //             "itemStyle": {
  //               "color": "#4285f4",
  //               "align": "right"
  //             },
  //             "label": {
  //               "position": [
  //                 -125,
  //                 -10
  //               ],
  //               "width": 125,
  //               "overflow": "break"
  //             },
  //             "color": "blue",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "1-1",
  //             "depth": 1,
  //             "value": 24193.25,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "Revenue",
  //             "depth": 1,
  //             "value": 96773,
  //             "itemStyle": {
  //               "color": "#0065fe"
  //             },
  //             "label": {
  //               "position": [
  //                 "0%",
  //                 "-40"
  //               ],
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "black",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "2-1",
  //             "depth": 2,
  //             "value": 18144.9375,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "Gross Profit",
  //             "depth": 2,
  //             "value": 17660,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": "top",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "append": [
  //               {
  //                 "name": "Margin",
  //                 "value": "18.25%"
  //               }
  //             ],
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "COGS",
  //             "depth": 2,
  //             "value": 79113,
  //             "itemStyle": {
  //               "color": "#cc0003"
  //             },
  //             "label": {
  //               "position": "bottom",
  //               "width": 110,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "3-1",
  //             "depth": 3,
  //             "value": 9072.46875,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "Operating Income",
  //             "depth": 3,
  //             "value": 8891,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": "top",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "append": [
  //               {
  //                 "name": "Margin",
  //                 "value": "9.19%"
  //               }
  //             ],
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Net Interest Income",
  //             "depth": 3,
  //             "value": 910,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": [
  //                 "-50",
  //                 "-20"
  //               ],
  //               "width": 110,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Other Income (Expense)",
  //             "depth": 3,
  //             "value": 172,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": "bottom",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "3-2",
  //             "depth": 3,
  //             "value": 1,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "Total Operating Expense",
  //             "depth": 3,
  //             "value": 8769,
  //             "itemStyle": {
  //               "color": "#cc0003"
  //             },
  //             "label": {
  //               "position": "bottom",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "4-1",
  //             "depth": 4,
  //             "value": 1,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "Pretax Income",
  //             "depth": 4,
  //             "value": 9973,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": "top",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "append": [
  //               {
  //                 "name": "Margin",
  //                 "value": "10.31%"
  //               }
  //             ],
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "4-2",
  //             "depth": 4,
  //             "value": 27217.40625,
  //             "itemStyle": {
  //               "color": "transparent"
  //             },
  //             "label": {
  //               "show": false
  //             },
  //             "emphasis": {
  //               "label": {
  //                 "show": false
  //               }
  //             }
  //           },
  //           {
  //             "name": "SG&A",
  //             "depth": 4,
  //             "value": 4800,
  //             "itemStyle": {
  //               "color": "#cc0003"
  //             },
  //             "label": {
  //               "position": "right",
  //               "width": 110,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "R&D",
  //             "depth": 4,
  //             "value": 3969,
  //             "itemStyle": {
  //               "color": "#cc0003"
  //             },
  //             "label": {
  //               "position": "right",
  //               "width": 110,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Net Income",
  //             "depth": 5,
  //             "value": 14999,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "green",
  //             "append": [
  //               {
  //                 "name": "Margin",
  //                 "value": "15.50%"
  //               }
  //             ],
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Minority Interests",
  //             "depth": 5,
  //             "value": -25,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "emphasis": {
  //               "label": {}
  //             }
  //           },
  //           {
  //             "name": "Tax",
  //             "depth": 5,
  //             "value": -5001,
  //             "itemStyle": {
  //               "color": "#2ba02d"
  //             },
  //             "label": {
  //               "position": "right",
  //               "width": 120,
  //               "overflow": "break"
  //             },
  //             "color": "red",
  //             "append": [
  //               {
  //                 "name": "Tax Rate",
  //                 "value": "-50.15%"
  //               }
  //             ],
  //             "emphasis": {
  //               "label": {}
  //             }
  //           }
  //         ],
  //         "links": [
  //           {
  //             "source": "Automotive segment",
  //             "value": 90738,
  //             "target": "Revenue",
  //             "lineStyle": {
  //               "color": "#85b2f9",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Energy generation and storage segment",
  //             "value": 6035,
  //             "target": "Revenue",
  //             "lineStyle": {
  //               "color": "#85b2f9",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Revenue",
  //             "value": 17660,
  //             "target": "Gross Profit",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Revenue",
  //             "value": 79113,
  //             "target": "COGS",
  //             "lineStyle": {
  //               "color": "#e18584",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Gross Profit",
  //             "value": 8891,
  //             "target": "Operating Income",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Gross Profit",
  //             "value": 8769,
  //             "target": "Total Operating Expense",
  //             "lineStyle": {
  //               "color": "#e18584",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Total Operating Expense",
  //             "value": 4800,
  //             "target": "SG&A",
  //             "lineStyle": {
  //               "color": "#e18584",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Total Operating Expense",
  //             "value": 3969,
  //             "target": "R&D",
  //             "lineStyle": {
  //               "color": "#e18584",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Operating Income",
  //             "value": 8891,
  //             "target": "Pretax Income",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Net Interest Income",
  //             "value": 910,
  //             "target": "Pretax Income",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Other Income (Expense)",
  //             "value": 172,
  //             "target": "Pretax Income",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Pretax Income",
  //             "value": 14974,
  //             "target": "Net Income",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Pretax Income",
  //             "value": -5001,
  //             "target": "Tax",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           },
  //           {
  //             "source": "Pretax Income",
  //             "value": -25,
  //             "target": "Minority Interests",
  //             "lineStyle": {
  //               "color": "#99ce9a",
  //               "opacity": 0.8
  //             }
  //           }
  //         ],
  //         "tooltip": {},
  //         "z": 2,
  //         "coordinateSystem": "view",
  //         "orient": "horizontal",
  //         "nodeWidth": 20,
  //         "draggable": true,
  //         "levels": [],
  //         "nodeAlign": "justify",
  //         "lineStyle": {
  //           "color": "#314656",
  //           "opacity": 0.2,
  //           "curveness": 0.5
  //         },
  //         "select": {
  //           "itemStyle": {
  //             "borderColor": "#212121"
  //           }
  //         },
  //         "animationEasing": "linear",
  //         "animationDuration": 1000
  //       }
  //     ],
  //     "visualMap": [],
  //     "dataZoom": [],
  //     "markArea": [],
  //     "markLine": [],
  //     "markPoint": [],
  //     "legend": []
  //   };
</script>